import {
  Client,
  GatewayIntentBits,
  ModalBuilder,
  TextInputBuilder,
  TextInputStyle,
  ActionRowBuilder,
  InteractionType
} from "discord.js";

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent
  ]
});

const TARGET_ROLE = "emperor7g";

client.once("ready", () => {
  console.log(`Bot aktif sebagai ${client.user.tag}`);
});

client.on("messageCreate", async (message) => {
  if (message.content !== "!announce") return;
  if (!message.member.permissions.has("Administrator")) return;

  const modal = new ModalBuilder()
    .setCustomId("announce_modal")
    .setTitle("ğŸ“¢ Pengumuman Emperor");

  const input = new TextInputBuilder()
    .setCustomId("announcement")
    .setLabel("Isi Pengumuman")
    .setStyle(TextInputStyle.Paragraph)
    .setRequired(true);

  modal.addComponents(new ActionRowBuilder().addComponents(input));

  await message.channel.send({
    content: "ğŸ“¨ Silakan isi pengumuman:",
  });

  await message.channel.awaitMessages({
    max: 1,
    time: 1000
  });

  await message.channel.send({ content: "Gunakan slash /announce (modal)" });
});

client.on("interactionCreate", async (interaction) => {
  if (interaction.type !== InteractionType.ModalSubmit) return;
  if (interaction.customId !== "announce_modal") return;

  const role = interaction.guild.roles.cache.find(
    r => r.name === TARGET_ROLE
  );

  if (!role) {
    return interaction.reply({
      content: "âŒ Role tidak ditemukan",
      ephemeral: true
    });
  }

  const text = interaction.fields.getTextInputValue("announcement");

  await interaction.channel.send(
    `ğŸ“¢ **PENGUMUMAN RESMI**\n${role}\n\n${text}`
  );

  await interaction.reply({
    content: "âœ… Pengumuman terkirim!",
    ephemeral: true
  });
});

client.login(process.env.TOKEN_BOT_DISCORD);
